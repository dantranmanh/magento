<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition End User License Agreement
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magento.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright Copyright (c) 2006-2015 X.commerce, Inc. (http://www.magento.com)
 * @license http://www.magento.com/license/enterprise-edition
 */
/* @var $this Mage_Reports_Block_Product_Viewed */
?>
<?php if ($_products = $this->getRecentlyViewedProducts()): 

?>
<div class="block block-list block-viewed">
    <div class="block-title">
        <strong><span><?php echo $this->__('Recently Viewed Products') ?></span></strong>
    </div>
    <div class="block-content">
       <div class="itemslider-wrapper slider-arrows1 slider-arrows1-pos-top-right slider-pagination1">
			<div id="itemslider-featured-viewd" class="itemslider itemslider-responsive products-grid equal-height centered">
				<?php foreach ($_products as $_product): ?>
					 <div class="item">
						<div class="product-image-wrapper" >
							<a href="<?php echo $this->getProductUrl($_product) ?>" title="" class="product-image">
								<img  id="product-collection-image-<?php echo $_product->getId(); ?>"
										src="<?php echo Mage::helper('catalog/image')->init($_product, 'small_image')->resize(230,185); ?>"
										alt="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true); ?>" />
							</a>
						
							<?php //Add-to links
							  $_helper = $this->helper('catalog/output');
								$theme = $this->helper('ultimo');
							  $helpTemplate = $this->helper('ultimo/template');
								 if ($theme->getCfg('category_grid/display_addtolinks') != 0 
									 && $theme->getCfg('category_grid/addtolinks_simple'))
								 {
									 if ($theme->getCfg('category_grid/display_addtolinks') == 1) //Display on hover
									 {
										 echo $helpTemplate->getCategoryAddtoLinksIcons(
										 $_product, $this->getAddToCompareUrl($_product), 'addto-links-icons addto-onimage visible-onhover');
									 }
									 else //Always display
									 {
										 echo $helpTemplate->getCategoryAddtoLinksIcons(
										 $_product, $this->getAddToCompareUrl($_product), 'addto-links-icons addto-onimage');
									 }
								 }
							?>
							
						</div> <!-- end: product-image-wrapper -->
						
						<h3 class="product-name"><a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $this->stripTags($_product->getName(), null, true) ?>"><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></a></h3>
						<?php  //check if product is a configurable type or not
						$_product= Mage::getModel('catalog/product')->load($_product->getId());
						//die( $_product->getListSwatchAttrValues());
						   if (Mage::helper('configurableswatches')->isEnabled() && $_product && $_product->getId()
							&& ($_attrValues = $_product->getListSwatchAttrValues()) && count($_attrValues) > 0):

							$_swatchAttribute = Mage::helper('configurableswatches/productlist')->getSwatchAttribute();
//die('tets');
							$_dimHelper = Mage::helper('configurableswatches/swatchdimensions');
							$_swatchInnerWidth = $_dimHelper->getInnerWidth(Mage_ConfigurableSwatches_Helper_Swatchdimensions::AREA_LISTING);
							$_swatchInnerHeight = $_dimHelper->getInnerHeight(Mage_ConfigurableSwatches_Helper_Swatchdimensions::AREA_LISTING);
							$_swatchOuterWidth = $_dimHelper->getOuterWidth(Mage_ConfigurableSwatches_Helper_Swatchdimensions::AREA_LISTING);
							$_swatchOuterHeight = $_dimHelper->getOuterHeight(Mage_ConfigurableSwatches_Helper_Swatchdimensions::AREA_LISTING);
						?>
						<ul class="configurable-swatch-list configurable-swatch-<?php echo $_swatchAttribute->getAttributeCode() ?> clearfix">
							<?php foreach ($_attrValues as $_optionValue => $_optionLabel): ?>
								<?php
								$_optionCode = Mage::helper('configurableswatches')->getHyphenatedString($_optionLabel);
								$_swatchUrl = Mage::helper('configurableswatches/productimg')->getSwatchUrl($_product, $_optionLabel, $_swatchInnerWidth, $_swatchInnerHeight, $_swatchType);
								//print_r($_swatchUrl);
								$_hasImage = !empty($_swatchUrl);
								$_liClasses = array();
								$_aClass = 'swatch-link swatch-link-' . $_swatchAttribute->getId();
								if ($_hasImage) {
									if ($_swatchType == 'media') {
										$_liClasses[] = 'is-media';
									}
									$_aClass .= ' has-image';
								} elseif (strlen($_optionLabel) > 3) {
									$_liClasses[] = 'wide-swatch';
								}
								if (Mage::helper('configurableswatches/productlist')->swatchMatchesFilter($_optionValue)) {
									$_liClasses[] = 'filter-match';
								}
								$_liClass = (!empty($_liClasses)) ? ' ' . implode(' ', $_liClasses) : '';
								?>
							<li class="option-<?php echo $_optionCode; ?><?php echo $_liClass; ?>" data-product-id="<?php echo $_product->getId() ?>" data-option-label="<?php echo $_optionLabel ?>">
								<a href="javascript:void(0)" name="<?php echo $_optionCode; ?>" class="<?php echo $_aClass ?>" title="<?php echo $_optionLabel; ?>"
									   style="height: <?php echo $_swatchOuterHeight ?>px; <?php if (!$_hasImage): ?>min-<?php endif; ?>width: <?php echo $_swatchOuterWidth ?>px;">
									<span class="swatch-label" style="height: <?php echo $_swatchInnerHeight ?>px; <?php if (!$_hasImage): ?>min-<?php endif; ?>width: <?php echo $_swatchInnerWidth ?>px; line-height: <?php echo $_swatchInnerHeight ?>px;">
									<?php if ($_hasImage): ?>
										<img src="<?php echo $_swatchUrl; ?>" alt="<?php echo $_optionLabel; ?>" width="<?php echo $_swatchInnerWidth ?>" height="<?php echo $_swatchInnerHeight ?>" />
									<?php else: ?>
										<?php echo $_optionLabel; ?>
									<?php endif; ?>
									 </span>
								</a>
							</li>
							<?php endforeach; ?>
						</ul>
						<?php
						endif;
					?>
            <?php echo $this->getPriceHtml($_product, true) ?>
			</div> <!-- item -->
				<?php endforeach; ?>
			</div>
        </div>
        <script type="text/javascript">decorateList('recently-viewed-items');</script>
    </div>
</div>
<script type="text/javascript">
//<![CDATA[
    jQuery(function($) {
        
        var owl = $('#itemslider-featured-viewd');
        owl.owlCarousel({

       
            lazyLoad: true,
        
            itemsCustom : [
				[0, 1], [320, 2], [480, 3], [768, 4], [960, 4], [1280, 4]
			  ],
            responsiveRefreshRate: 50,
            slideSpeed: 6000,

       
            paginationSpeed: 5000,
      
            scrollPerPage: true,
   
            autoPlay: 6000,
            stopOnHover: true,
            rewindNav: true,
            rewindSpeed: 600,

    
            pagination: true,
    

            navigation: true,
            navigationText: false

        }); //end: owl

    });
//]]>
</script>
<?php
//Provides a block where additional page components may be attached, primarily good for in-page JavaScript
if ($this->getChild('after')) {
    $_afterChildren = $this->getChild('after')->getSortedChildren();
    foreach ($_afterChildren as $_afterChildName) {
        $_afterChild = $this->getChild('after')->getChild($_afterChildName);
        //set product collection on after blocks
        $_afterChild->setProductCollection($this->getRecentlyViewedProducts());
        echo $_afterChild->toHtml();
    }
}
?>
<?php endif; ?>


